Enable-PSRemoting -Force

New-NetFirewallRule -DisplayName "Allow WinRM from tools.domain.com" -Direction Inbound -LocalPort 5985 -Protocol TCP -Action Allow -RemoteAddress (Resolve-DnsName tools.domain.com).ipaddress

Set-Item -Path WSMan:\localhost\Service\IPv4Filter -Value "$((Resolve-DnsName tools.domain.com).IPAddress)"

Restart-Service WinRM

action = New-ScheduledTaskAction -Execute 'powershell.exe' -Argument '-WindowStyle Hidden -file "C:/webtools-scripts/Start-1C.ps1"'; Register-ScheduledTask -TaskName Start-1C -Action $action -User (Get-CimInstance -ClassName Win32_ComputerSystem).UserName; $action = New-ScheduledTaskAction -Execute 'powershell.exe' -Argument '-WindowStyle Hidden -file "C:/webtools-scripts/CleanCache-1C.ps1"'; Register-ScheduledTask -TaskName CleanCache-1C -Action $action -User (Get-CimInstance -ClassName Win32_ComputerSystem).UserName; Set-ExecutionPolicy -ExecutionPolicy Unrestricted; $InterCustPath =  (Get-Process InterCust -Module | Select-Object -ExpandProperty FileName) | Select-String 'InterCust.exe'; $action = New-ScheduledTaskAction -Execute $InterCustPath; Register-ScheduledTask -TaskName Start-InterCust -Action $action -User (Get-CimInstance -ClassName Win32_ComputerSystem).UserName; $action = New-ScheduledTaskAction -Execute 'powershell.exe' -Argument '-WindowStyle Hidden -file "C:\webtools-scripts\Lockscreen.ps1"'; Register-ScheduledTask -TaskName Lockscreen -Action $action -User (Get-CimInstance -ClassName Win32_ComputerSystem).UserName;$action = New-ScheduledTaskAction -Execute 'powershell.exe' -Argument '-WindowStyle Hidden -file "C:/webtools-scripts/doremi.ps1"'; Register-ScheduledTask -TaskName Doremi -Action $action -User (Get-CimInstance -ClassName Win32_ComputerSystem).UserName; $sbis3pluginPath = "C:\Program Files (x86)\Tensor Company Ltd\Saby Plugin\sbis3plugin.exe"; $action = New-ScheduledTaskAction -Execute $sbis3pluginPath; Register-ScheduledTask -TaskName Start-SbisPlugin -Action $action -User (Get-CimInstance -ClassName Win32_ComputerSystem).UserName
